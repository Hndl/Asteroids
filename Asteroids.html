<!DOCTYPE html>
<html>
	<title>Asteroids</title>

	
	

	
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.6.0/p5.js"></script>
	<script src="ship.js"></script>
	
	<script type="text/javascript">

		//TODO
	
	
		var spaceShip ;
		var asteroid = []; 
		var maxAsteroids = 8;
		var dustSystem ;
		var hud ;
		var wave = 0;
		var img ;

		function setup() {
			canvas = createCanvas(window.innerWidth-50,window.innerHeight-50);
			hud = new Hud (width, height);	
			dustSystem = new DustControl(100);
 			spaceShip = new Ship( width, height);
 			for ( let i = 0 ; i < maxAsteroids ; i ++ ){
 				asteroid.push(  new Asteroid(floor(random(width)), floor(random(height))));
 			}
 			wave++;
 			//img = loadImage('./space.jpg'); 
 			//console.log(img);
 		}

 		function keyReleased () {
 			//console.log(`keyReleased:${keyCode}`);
 			switch ( keyCode ) {
 				case 32 : /* SPACE FIRE */
 					spaceShip.fire();
 					break;
 				case 38 : /* THRUST */ 
 					//console.log(`keyReleased:${keyCode} - shut off thrust`);
 					spaceShip.shutOffThrusters();
 					break;
 				case 39 : /* RIGHT */ 
 				case 37 : /* LEFT */
 					spaceShip.stopRotate();
 					break;
 			}
 		}
 		function keyPressed ( ) {
 			//console.log(`keyPressed:${keyCode}`);

 			switch ( keyCode ) {
 				case 32 : /* SPACE FIRE */
 					break;
 				case 38 : /* THRUST */ 
 					//console.log(`keyReleased:${keyCode} - engage thrust`);
 					spaceShip.engageThrusters();
 					break;
 				case 39 : /* RIGHT */ 
 					spaceShip.rotateRight();
 					break;
 				case 37 : /* LEFT */
 					spaceShip.rotateLeft();
 					break;
 			}
 		}
		function draw() {
			background(0,0,0,150);
			//image(img, 100,100);
			dustSystem.draw();
			for ( let i = asteroid.length-1 ; i >=0 ; i-- ){
 				asteroid[i].update();
 				asteroid[i].draw();
 				spaceShip.hit(asteroid[i]);

 				if ( asteroid[i].explode ) {
 					//console.log(`asteroid:explode`);
 					//asteroid.concat( );
 					let newA = asteroid[i].breakup();
 					for ( let j = 0 ; j < newA.length ; j++) {
 						asteroid.push(newA[j]);
 					}
 					
 					asteroid.splice(i,1);

 				}
 				//console.log(asteroid[i]);
 				hud.update( spaceShip.fireCount, asteroid.length, wave);
				hud.draw();
 			}
			spaceShip.draw();
			spaceShip.update();

			if (spaceShip.isDead() ) {
				push();
				fill( 255 );
				textSize(24);
				text("Game Over",(width-100)/2, height/2)
				pop();
				noLoop();
			}

			if ( asteroid.length == 0 ) {
				maxAsteroids+=2;
				for ( let i = 0 ; i < maxAsteroids ; i ++ ){
					asteroid.push(  new Asteroid(floor(random(width)), floor(random(height))));
				}
				wave++;

			}

		}






	
	</script>
<body>

</body>
</html>


